{template 'common/header'}
<style>
    .footer {
        display: none;
    }

    /*未关注提示框样式*/
    .main {
        position: fixed; /* 使用绝对定位或固定定位  */
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        text-align: center;
        z-index: 1000;
    }

    .background {
        position: fixed; /* 使用绝对定位或固定定位  */
        left: 0px;
        top: 0px;
        width: 100%;
        height: 100%;
        text-align: center;
        background: #333333;
        opacity: 0.5;
    }

    .modal_main {
        position: relative;
        z-index: 9999;
        display: block;
        margin: 110px auto;
        width: 300px;
        background-color: #ffffff;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: #666 0px 0px 10px;

    }

    .modal_head {
        display: block;
        width: 300px;
        height: 57px;
        padding: 14px;
    }

    .modal_code {
        display: block;
        width: 300px;
        padding: 10px;
    }

    .modal_btn {
        display: block;
        width: 300px;
        height: 40px;
        text-align: center;
        font-size: 20px;
        padding: 10px;
        color: #007aff;
        cursor: pointer;
    }

    .line {
        display: block;
        margin: 0;
        height: 1px;
        background-color: #adadad;
        width: 300px;
    }

    .modal_code img {
        display: block;
        margin: auto;
        width: 270px;
        height: 270px;
    }

</style>


<div style="margin: 0;padding: 0;background-color: #eeeeee">
    <div class="mui-card-content">
        <img src="{php echo   'http://'.$_SERVER['SERVER_NAME'].'/attachment/'.$activity[0]['head_pic'] }" alt=""
             width="100%">
    </div>
    <div style="padding: 15px;background-color: #ffffff">
        <div><h3>{$activity[0]['name']}</h3></div>
        <div style="margin:5px 5px auto">原价<strike>{$activity[0]['prize_old_price']}</strike></div>
        {if !empty($order)}
        <div style="margin:5px 5px auto">当前价格<strong style="color:#f0ad4e;">{$order[0]['current_price']}</strong>元</div>
        {else}
        <div style="margin:5px 5px auto">底价<strong style="color:#f0ad4e;">{$activity[0]['prize_floor_price']}</strong>元
        </div>
        {/if}

        {if $order[0]['order_status']!=0&&!empty($order)}
        <div style="border:1px solid #f0ad4e;text-align: center;margin: 5px auto;border-radius: 3px;">
            <h3 style="color:#f0ad4e;line-height: 30px;">恭喜你砍价成功</h3>
            {if $order[0]['order_status']==1}
            <input id="pay" type="button"
                   style="margin-bottom:10px;font-size: 20px;border:none;background-color:#f0ad4e;color:#ffffff;border-radius: 3px; "
                   value="支付">
            {elseif $order[0]['order_status']==2}
            <input id="success" type="button"
                   style="margin-bottom:10px;font-size: 20px;border:none;background-color:#f0ad4e;color:#ffffff;border-radius: 3px; "
                   value="完善资料">
            <p>请点击按钮填写或修改资料，耐心等待客服的联系</p>
            {else}
            <p>奖品已发出</p>
            {/if}
        </div>
        {elseif !empty($order)&&$order[0]['order_status']==0}
        <div style="border:1px solid #f0ad4e;text-align: center;margin: 5px auto;border-radius: 3px;">
            <h3 style="color:#f0ad4e;line-height: 30px;">你已经参与砍价</h3>
            <p>你可以点击右上角将链接分享给别人帮忙砍价</p>

        </div>
        {else}
        <div style="border:1px solid #f0ad4e;text-align: center;margin: 5px auto;border-radius: 3px;">
            <h3 style="color:#f0ad4e;line-height: 30px;">Ta已经砍价成功</h3>
            <input id="btn" type="button"
                   style="margin-bottom:10px;font-size: 20px;border:none;background-color:#f0ad4e;color:#ffffff;border-radius: 3px; "
                   value="我也要砍价">
            <input id="sub" type="hidden" value="{$activity[0]['is_subscription_launch']}">
            <input id="follow" type="hidden" value="{$information['follow']}">
            <input id="openid" type="hidden" value="{$openid}">
        </div>
        {/if}
    </div>
    <div style="padding: 3px;">
        {if !empty($order)}
        <div style="background-color: #eeeeee;width: 100%;text-align: center;margin:5px auto; ">
            <h3 style="line-height:55px;">砍价记录</h3>
            {loop $assist_information $data}
            <div style="text-align: left;padding:2px 10px"><strong style="color: #f0ad4e">{$data['nickname']}</strong>帮你砍掉了<strong
                    style="color: #f0ad4e">{$data['price']}</strong>元。
            </div>
            {/loop}
            <span style="display:block;width:100%;height:20px;color: #333333;overflow: hidden;">-----------------------------------------------------------------------------------------------------------</span>
        </div>
        {/if}
        <div style="text-align: center;padding: 5px;background-color: #ffffff">
            <h3 style="line-height: 50px;">活动规则</h3>
            {$html}
        </div>
        <!--<div style="margin: 10px auto;background-color: #ffffff;text-align: center;padding: 10px;">-->
        <!--<input type="button" style="outline: none;width:240px;height:30px;color:#ffffff;text-align:center;border-radius: 10px;background-color: #333333;" value="返回活动列表">-->
        <!--</div>-->
    </div>
</div>
<div class="main">
    <div class="modal_main">
        <div class="modal_head">
            <h4>请先关注公众号</h4>
            <p>并按公众号提示参加活动</p>
        </div>
        <div class="line"></div>
        <div class="modal_code">
            <img class="img"
                 src="{php echo   'http://'.$_SERVER['SERVER_NAME'].'/attachment/'.$activity[0]['wx_qr_code'] }">
        </div>

        <div class="line"></div>
        <div class="modal_btn">
            <label>确定</label>
        </div>
    </div>
    <div class="background"></div>
</div>

<script>
    $('.main').hide() //隐藏提示框

    /*分享链接JS*/
    wx.ready(function () {
        sharedata = {
            title: '{$activity[0]["name"]}',
            desc: '{$activity[0]["wx_friend_centent"]}',

            link: "{php echo   'http://'.$_SERVER['SERVER_NAME'] . str_replace('./','/',$this->createMobileUrl('forward',array('oid'=>$order[0]['id'])))  }",
            imgUrl: 'http://admin.codestorm.cn/attachment/{$activity[0]["head_pic"]}',
            success: function () {
            },
            cancel: function () {
            }
        };
        wx.onMenuShareAppMessage(sharedata);

        wx.hideMenuItems({
            menuList: ["menuItem:copyUrl", "menuItem:share:qq", "menuItem:originPage", "menuItem:share:QZone", "menuItem:openWithQQBrowser", "menuItem:openWithSafari"] // 要显示的菜单项，所有menu项见附录3
        });

    });

        /*未订阅提示JS*/
        $('#btn').bind('click', function () {

            var openid = $('#openid').val();//获取OPEIN
                var sub = $('#sub').val();//获取是否需要关注
                var follow = $('#follow').val();//获取是否有关注
                //判断是否
                //判断是否需要关注公众号或OEPENID 存在才能发起活动
                if ((sub == 1 && follow == 0)||openid.length==0) {
                    $('.main').show()
                    $("body").css({overflow: "hidden"});
                } else {
                    window.location = "{php echo $this->createMobileUrl('index',array('aid'=>$aid,'op'=>'join'));}";
                }
        })



    //关闭提示框按钮
    $('.modal_btn').bind('click', function () {
        $('.main').hide();
        $("body").css({overflow: "visible"});
    })


    //支付按钮跳转
    $('#pay').bind('click', function () {
        window.location = "{php echo $this->createMobileUrl('index',array('aid'=>$aid,'op'=>'pay'));}";
    })


    //填写资料跳转
    $('#success').bind('click', function () {
        window.location = "{php echo $this->createMobileUrl('information',array('oid'=>$order[0]['id']));}";
    })

</script>
{template 'common/footer'}
